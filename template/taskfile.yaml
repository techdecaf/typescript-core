# this file was generated by a cgen template: [typescript-core]
# documentation for tasks can be found @ https://github.com/techdecaf/tasks

options:
  log: true

variables:
  CI_PROJECT_NAME: '{{ReadFile `./package.json` | JQ `name`}}'
  CI_PROJECT_VERSION: '{{ReadFile `./package.json` | JQ `version`}}'
  CI_REPOSITORY_URL: '{{ReadFile `./package.json` | JQ `repository.url`}}'
  CI_MAJOR_VERSION: '{{(semver .CI_PROJECT_VERSION).Major}}'
  CI_COMMIT_TAG: '{{TRY `git describe --tags --always --dirty --abbrev=0`}}'
  CI_COMMIT_REF_NAME: '{{TRY `git rev-parse --abbrev-ref HEAD`}}'
  CI_COMMIT_SHA: '{{TRY `git rev-parse HEAD`}}'

tasks:
  default:
    description: is the task that runs when no tasks have been specified.
    commands: [tasks list]

  clean:
    description: remove files created as part of the build step.
    commands: [rm -rf coverage.txt .npmrc build]

  dependencies:
    description: install all required dependencies
    commands: [yarn]

  build:
    description: build current project
    commands: [yarn build]

  publish:
    description: publish artifacts to registry
    commands: [yarn publish --non-interactive]

  audit:
    description: audit for security vulnerabilities
    commands: [yarn audit]

  test:
    description: run tests
    commands: [yarn test --maxWorkers=100%]

  end2end:
    description: runs integration and end to end testing
    commands: [yarn test:e2e]

  coverage:
    description: run test coverage
    commands: ['yarn test:coverage']

  prerelease:
    description: bump version and release for deployment
    commands:
      - yarn version --prerelease
      - git push --follow-tags --no-verify

  release:
    description: bump version and release for deployment
    commands:
      - yarn version --patch
      - git push --follow-tags --no-verify

  upgrade:
    description: upgrade the current project
    commands: [cgen upgrade, yarn upgrade --latest]

  oops:
    description: undo last commit
    commands: [git reset HEAD~1]
